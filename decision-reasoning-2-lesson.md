## Содержание

- [Содержание](#содержание)
- [Поддомены](#поддомены)
- [Bounded contexts](#bounded-contexts)
- [Расхождение bounded contexts из поддоменов и из ES модели](#расхождение-bounded-contexts-из-поддоменов-и-из-es-модели)
- [Важные характеристики проекта](#важные-характеристики-проекта)
- [Выбор архитектурного стиля](#выбор-архитектурного-стиля)
- [Спорные моменты](#спорные-моменты)
- [Вопросы](#вопросы)


## Поддомены

Главная цель проекта - борьба с усталостью и выгоранием котов-тестировщиков через делегирование рутины на топ 3% котов-воркеров

1. Мэтчинг клиента и воркера
   1. Максимальная сложность, частые изменения, главный core поддомен
   2. Ключевые слова из ТЗ: "самый совершенный матчинг между-клиентами и воркерами", "Благодаря отсеву и матчингу компания планирует выделяться на фоне конкурентов"
2. Регистрация и тестирование кандидатов-воркеров
   1. Высокая сложность, частые изменения, так как методы тестирования должны быть устойчивы к "взлому" и выявлять реальный уровень кандидата
   2. Ключевые слова из ТЗ: "самые передовые алгоритмы отсева воркеров"
   3. Включает в себя Выявление 3% лучших воркеров среди кандидатов (проверка заявок, регистрация и характезирование воркера), прохождение тестирования кандидатом
3. Изучение качества работы над заказами
   1. Средняя сложность, средняя частота изменений. Методы проверки будут адаптироваться к кейсам по работе с заказом.
   2. Включает в себя анализ процесса работы над заказом
4. Поддержание интереса менеджеров к работе
   1. Низкая сложность и частота изменений и приоритет
5. Сбор расходников
   1. Средняя сложность, низкая частота изменений
6. Уменьшение нагрузки на клиентов
   1. Большой поддомен, выделил его практически в последний момент. Скорее всего можно разделить на меньшие поддомены

## Bounded contexts

Маппинг поддомена и bounded contexts:
1. Мэтчинг клиента и воркера
   1. Система подбора воркера под заказ
2. Регистрация и тестирование кандидатов-воркеров
   1. Работа с заявками и проверка навыков кандидатов
   2. составление характеристики нового воркера???
3. Изучение качества работы
   1. анализ работы над заказами
4. Поддержание интереса менеджеров к работе
   1. Тотализатор
5. Сбор расходников
   1. склад
6. Уменьшение нагрузки на клиентов
   1. Работа с клиентами
   2. Работа с заказами

## Расхождение bounded contexts из поддоменов и из ES модели

Основная причина расхождения - вынесение технических шагов в ES модель и непонимание различий между бизнес процессом и технической реализацией

1. "Жизненный цикл заказа" и "создание и управление заказом" не являются отдельными bounded context, а скорее техническими шагами и частями более общего bounded context
2. "Выплаты денежных средств" также не является отдельным bounded context
3. Не посчитал некоторые процессы важными для отображения на ES модели, в частности: составление характеристик кандидата, добавление и вход в систему клиента
4. Выкинул процесс, связанный с доставкой расходников, так как не увидел явного описания в ТЗ, только процесс выдачи расходников/забора воркером
5. Также решил уменьшить coupling через использование планировщиков задач, вместо прямого уведомление о произошедшем событии
6. Практически убрал read model, так как не успел понять их смысл на переделанной ES
7. Расположил контексты и процессы в них в хронологическом порядке, что заметно повысило читаемость

## Важные характеристики проекта

1. Agility
   1. Высокая важность, критична на текущем этапе проекта, так как core-поддомены должны уметь адаптироваться под окружающую действительность
   2. Где взята - проверка гипотез (US-180), изменение набора тестов (US-090), общие пожелания к системе
2. Modifiability
   1. Высокая важность, связана с agility, причины те же
   2. Где взята - общие пожелания к системе ("критично проверять новые гипотезы по отсеву котов и изменять уже существующие с максимальной скоростью и надёжностью")
3. Usability
    1. Высокая важность, первые клиенты продукта - "выгоревшие" коты-тестировщики, которые забьют на продукт при любом неудобном и непонятном процессе
    2. Где взята - US-010, "основной целью которой станет уменьшение посторонней работы котов-тестировщиков" из контекста и проблемы домашки
4. Deployability
   1. Высокая важность, потому что важно быстро и предсказуемо выкатывать изменения
   2. Где взята - низкий TTM из общих пожеланий к системе
5. Maintainability
   1. Средне-высокая важность, связана с modifiability, причины те же
   2. Где взята - общие пожелания к системе ("критично проверять новые гипотезы по отсеву котов и изменять уже существующие с максимальной скоростью и надёжностью")
6. Simplicity
    1. Средне-высокая важность, связана с usability, причины те же
    2. Где взята - основная цель из раздела "контекст и проблема домашки"
7. Testability
   1. Средне-высокая важность, связана с agility и deployability
   2. Где взята - низкий TTM из общих пожеланий к системе
8. Elasticity
   1. Средняя важность, при этом scalability не так важна (ожидается умеренно низкое число заявок/измеримое число клиентов)
   2. Где взята - "для борьбы с ddos атаками конкурентов" (US-081)
9. Availability
   1. Средняя важность, так как конкурентные преимущества (подбор воркеров и мэтчинг) должны выделяться и быть доступными
   2. Где взята - неявно, из понимания важности core subdomains
10. Reliability
    1. Средняя важность
    2. Где взята - Явно указано в общих пожеланиях

## Выбор архитектурного стиля

Список учитываемых характеристик: agility, deployability, elasticity, reliability , maintainability, testability, modifiability

Монолитные стили не подходят по нескольким критичным причинам:
- Невозможность управлять нагрузкой разных частей системы (нагрузка на отсев кандидатов и работу с заявками несравнимо выше, чем нагрузка на тотализатор)
- Трудность изменять core subdomains и проверять гипотезы быстро и безопасно
- В общем и целом, высокий показатель TTM
- Сумма звездочек по важным характеристикам - 12 (layered), 16 (modular monolith)

Остается выбор между 2 распределенными стилями. Их общие особенности (как достоинства, так и недостатки):
- Высокие показатели agility, deployability, reliability, testability
- Возможность изменять логику поддоменов быстро и изолированно
- Требуют больше усилий и бюджета для настраивания инфраструктуры, но команда разработки еще не собрана, можно подобрать devops и всех нужных людей для корректной настройки инфраструктуры

Особенности service-based:
- Не требует излишнего "дробления" на мелкие сервисы
- Промежуточный вариант между монолитом и микросервисами, как в плане сложности, так и в плане затрат
- Сумма звездочек по важным характеристикам - 23

Особенности microservices:
- Высокие показатели elasticity, modifiability, maintainability
- Подразумевает, что 1 bounded context = 1 микросервис (скорее минус)
- Легко можно скатиться к распределенному монолиту, если нарушать правила
- Сумма звездочек по важным характеристикам - 32

**Итоговый выбор** - микросервисы

## Спорные моменты

- Поддомен "Уменьшение нагрузки на клиентов" не нравится, если делить его на основе bounded contexts, то работу с заказами теоретически можно в outsource
- Решил не выделять "хранение расходников" в отдельный поддомен
- Опять повторил ошибку и отложил крайне непонятную модель данных на конец, поэтому ее качество хромает

## Вопросы

- (ES) Как выбрать между прямым вызовом после выполнения события и кроном? Например, как сотруднику склада получить информацию о расходниках к заказу?
- (Бизнес) Как связаны расходники, используемые воркером, и печеньки, предназначенные клиенту? Нужен отдельный процесс для доставки печенек клиенту? По требованиям поставщик печенек доставляет их на склад, а не напрямую клиенту
